<main class="neg-list">
  <header class="neg-header">
    <h2>Minhas Negocia√ß√µes</h2>
    <div class="header-actions">
      <ng-container *ngIf="(rows$ | async) as rows">
        <span class="count-badge" *ngIf="rows.length">
          {{ rows.length }} {{ rows.length === 1 ? 'negocia√ß√£o' : 'negocia√ß√µes' }}
        </span>
      </ng-container>
    </div>
  </header>

  <div class="error-message" *ngIf="error()">
    <p>{{ error() }}</p>
  </div>

  <div class="loading" *ngIf="loading()">
    <p>Carregando negocia√ß√µes...</p>
  </div>

  <section class="table-wrapper" *ngIf="!loading() && !error(); else vazio">
    <ng-container *ngIf="rows$ | async as rows">
    <table class="neg-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Abertura</th>
          <th>Negociando com</th>
          <th>A√ß√µes</th>
          <th>Valor</th>
          <th>Status</th>
          <th>CEP</th>
          <th>C√≥digo de Rastreamento</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of rows" class="neg-row" (click)="open(row.id)">
          <td class="id-cell">
            <span class="role-chip" [class.buyer]="row.roleChip === 'B'" [class.seller]="row.roleChip === 'V'">
              {{ row.roleChip }}
            </span>
            <a class="id-link" [routerLink]="['/negociacoes', row.id]" (click)="$event.stopPropagation()">#{{ row.idShort }}</a>
          </td>
          <td>{{ row.createdAt | date:'dd/MM/yyyy' }}</td>
          <td class="counterparty">
            <strong>{{ row.counterpartName }}</strong>
            <small class="muted">{{ row.roleChip === 'B' ? 'Vendedor' : 'Comprador' }}</small>
          </td>
          <td>
            <div class="actions">
              <span class="action" *ngFor="let act of row.actions">{{ act }}</span>
            </div>
          </td>
          <td>R$ {{ row.total | number:'1.2-2' }}</td>
          <td>
            <span class="status-pill"
              [class.pend]="row.status==='esperando_pagamento' || row.status==='PENDING_SELLER_ACCEPT'"
              [class.act]="row.status==='aguardando_envio' || row.status==='encaminhada' || row.status==='ACTIVE' || row.status==='WAITING_BUYER' || row.status==='WAITING_SELLER'"
              [class.done]="row.status==='concluido' || row.status==='conclu√≠do' || row.status==='COMPLETED'"
              [class.cancel]="row.status==='CANCELLED'"
              [class.exp]="row.status==='EXPIRED'">
              {{ row.status | statusLabel }}
            </span>
          </td>
          <td>{{ row.zip || '‚Äî' }}</td>
          <td>
            <span class="tracking" [class.is-empty]="row.tracking === '‚Äî'">
              {{ row.tracking }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
    </ng-container>
  </section>

  <ng-template #vazio>
    <div class="empty-state">
      <div class="empty-icon">üì¶</div>
      <h3>Nenhuma negocia√ß√£o encontrada</h3>
      <p class="muted">Voc√™ ainda n√£o possui negocia√ß√µes. Quando voc√™ criar ou receber uma negocia√ß√£o, ela aparecer√° aqui.</p>
    </div>
  </ng-template>
</main>
